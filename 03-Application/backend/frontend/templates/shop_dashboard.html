{% extends "base.html" %}
{% block title %}K√™nh Ng∆∞·ªùi B√°n - Shopee Clone{% endblock %}

{% block content %}
<style>
    .dashboard-container { display: flex; gap: 20px; }
    .sidebar { width: 250px; background: #fff; border-right: 1px solid #eee; padding: 20px; }
    .main-content { flex: 1; padding: 20px; }
    
    .stat-card { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
    .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
    .stat-value { font-size: 24px; font-weight: bold; color: #ee4d2d; }
    .stat-label { color: #666; font-size: 14px; }

    .section-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; border-left: 4px solid #ee4d2d; padding-left: 10px; }
    
    .data-table { width: 100%; border-collapse: collapse; background: #fff; }
    .data-table th, .data-table td { padding: 12px; border: 1px solid #eee; text-align: left; }
    .data-table th { background: #f8f9fa; font-weight: 600; }
    
    .btn-action { padding: 5px 10px; border-radius: 4px; text-decoration: none; font-size: 12px; color: #fff; }
    .btn-edit { background: #28a745; }
    .btn-delete { background: #dc3545; }
</style>

<div class="dashboard-container">
    <!-- Sidebar Menu -->
    <div class="sidebar">
        <h3>üè™ K√™nh Ng∆∞·ªùi B√°n</h3>
        <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #eee;">
            <p><strong>Shop:</strong> {{ shop_info.username }}</p>
            <p><strong>ID:</strong> {{ shop_id }}</p>
        </div>
        <ul style="list-style: none; padding: 0;">
            <li style="margin-bottom: 10px;"><a href="#" style="color: #ee4d2d; font-weight: bold;">üìä T·ªïng quan</a></li>
            <li style="margin-bottom: 10px;"><a href="#" style="color: #333;">üì¶ Qu·∫£n l√Ω S·∫£n ph·∫©m</a></li>
            <li style="margin-bottom: 10px;"><a href="#" style="color: #333;">üìÑ Qu·∫£n l√Ω ƒê∆°n h√†ng</a></li>
            <li style="margin-bottom: 10px;"><a href="#" style="color: #333;">üí∞ T√†i ch√≠nh</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        
        <!-- 1. Th·ªëng k√™ T·ªïng quan (S·ª≠ d·ª•ng Procedure sp_LayThongKeDashboardShop) -->
        <div class="section-title">T·ªïng quan Shop h√¥m nay</div>
        <div class="stat-grid">
            <div class="stat-card">
                <div class="stat-value">{{ stats.TotalRevenue | format_currency }}</div>
                <div class="stat-label">Doanh thu tr·ªçn ƒë·ªùi</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.TotalOrders }}</div>
                <div class="stat-label">T·ªïng ƒë∆°n h√†ng</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.TotalProductsSold }}</div>
                <div class="stat-label">S·∫£n ph·∫©m ƒë√£ b√°n</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ "%.1f"|format(stats.RealAvgRating) }} ‚≠ê</div>
                <div class="stat-label">ƒê√°nh gi√° Shop</div>
            </div>
        </div>

        <!-- [NEW] Import S·∫£n ph·∫©m t·ª´ Excel -->
        <div class="section-title">Nh·∫≠p s·∫£n ph·∫©m t·ª´ Excel</div>
        <div style="background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <form action="{{ url_for('import_products') }}" method="post" enctype="multipart/form-data" style="display: flex; gap: 10px; align-items: center;">
                <input type="file" name="file" accept=".xlsx, .xls" required style="padding: 5px;">
                <button type="submit" style="background: #ee4d2d; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                    üì§ T·∫£i l√™n & Nh·∫≠p d·ªØ li·ªáu
                </button>
            </form>
            <p style="margin-top: 10px; font-size: 13px; color: #666;">
                * File Excel c·∫ßn c√≥ c√°c c·ªôt: <code>CategoryID, ItemName, ProdName, Price, Stock, Description, ImageURL</code>
            </p>
        </div>

        <!-- 2. Danh s√°ch ƒê∆°n h√†ng M·ªõi (S·ª≠ d·ª•ng Procedure sp_LayDanhSachDonHangShop) -->
        <div class="section-title">ƒê∆°n h√†ng g·∫ßn ƒë√¢y</div>
        {% if recent_orders %}
        <table class="data-table" style="margin-bottom: 30px;">
            <thead>
                <tr>
                    <th>M√£ ƒêH</th>
                    <th>Ng√†y ƒë·∫∑t</th>
                    <th>Kh√°ch h√†ng</th>
                    <th>T·ªïng ti·ªÅn</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
                {% for order in recent_orders %}
                <tr>
                    <td>#{{ order.order_id }}</td>
                    <td>{{ order.OrderDate }}</td> <!-- L∆∞u √Ω: Key kh·ªõp v·ªõi Procedure -->
                    <td>{{ order.CustomerName }}</td>
                    <td>{{ order.total_amount | format_currency }}</td>
                    <td>
                        <span style="padding: 3px 8px; border-radius: 10px; background: #e8f0fe; color: #1967d2; font-size: 12px;">
                            {{ order.OrderStatus or 'Ch·ªù x·ª≠ l√Ω' }}
                        </span>
                    </td>
                    <td>
                        <a href="#" class="btn-action btn-edit">Chi ti·∫øt</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</p>
        {% endif %}

        <!-- 3. Danh s√°ch S·∫£n ph·∫©m (T√°i s·ª≠ d·ª•ng logic c≈© ho·∫∑c Procedure m·ªõi) -->
        <div class="section-title">S·∫£n ph·∫©m c·ªßa Shop</div>
        <div style="margin-bottom: 15px;">
            <form method="GET" action="{{ url_for('seller_dashboard') }}">
                <input type="text" name="keyword" placeholder="T√¨m t√™n s·∫£n ph·∫©m..." value="{{ current_keyword }}" style="padding: 8px; width: 300px;">
                <select name="status_filter" style="padding: 8px;">
                    <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                    <option value="C√≤n h√†ng" {% if current_status == 'C√≤n h√†ng' %}selected{% endif %}>C√≤n h√†ng</option>
                    <option value="H·∫øt h√†ng" {% if current_status == 'H·∫øt h√†ng' %}selected{% endif %}>H·∫øt h√†ng</option>
                </select>
                <button type="submit" style="padding: 8px 15px; background: #ee4d2d; color: white; border: none; cursor: pointer;">L·ªçc</button>
            </form>
        </div>

        {% if products %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>T√™n S·∫£n ph·∫©m</th>
                    <th>Gi√° b√°n</th>
                    <th>Kho</th>
                    <th>ƒê√£ b√°n</th>
                    <th>ƒê√°nh gi√°</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
                {% for p in products %}
                <tr>
                    <td>{{ p.prod_id }}</td>
                    <td>{{ p.prod_name }}</td>
                    <td>{{ p.price | format_currency }}</td>
                    <td>
                        {% if p.stock_quantity > 0 %}
                            <span style="color: green; font-weight: bold;">{{ p.stock_quantity }}</span>
                        {% else %}
                            <span style="color: red; font-weight: bold;">H·∫øt h√†ng</span>
                        {% endif %}
                    </td>
                    <td>{{ p.total_sales }}</td>
                    <td>{{ p.rating_avg }} ‚≠ê</td>
                    <td>
                        <a href="#" class="btn-action btn-edit">S·ª≠a</a>
                        <!-- Form x√≥a s·∫£n ph·∫©m (Demo) -->
                        <!-- <form action="{{ url_for('delete_product', prod_id=p.prod_id) }}" method="POST" style="display:inline;">
                            <button type="submit" class="btn-action btn-delete" onclick="return confirm('X√≥a s·∫£n ph·∫©m n√†y?')">X√≥a</button>
                        </form> -->
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o.</p>
        {% endif %}

    </div>
</div>
{% endblock %}
