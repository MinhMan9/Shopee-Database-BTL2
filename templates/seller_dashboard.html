{% extends "base.html" %}

{% block title %}Qu·∫£n L√Ω S·∫£n Ph·∫©m - K√™nh B√°n H√†ng{% endblock %}

{% block content %}
    {% if is_customer_user %}
        <div style="float: right; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: #e3f2fd;">
            B·∫°n l√† **CUSTOMER**. <a href="{{ url_for('customer_dashboard') }}">Chuy·ªÉn sang Trang Mua H√†ng üõçÔ∏è</a>
        </div>
    {% endif %}

    <h2>üìä T·ªïng Quan Shop</h2>
    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
        <div style="border: 1px solid #ccc; padding: 15px; border-radius: 8px; flex: 1; background-color: #f9f9f9;">
            <h3>üí∞ Doanh Thu T·ªïng</h3>
            <p style="font-size: 24px; font-weight: bold; color: #28a745;">{{ dashboard_stats.TotalRevenue | format_currency }}</p>
        </div>
        <div style="border: 1px solid #ccc; padding: 15px; border-radius: 8px; flex: 1; background-color: #f9f9f9;">
            <h3>‚≠ê ƒê√°nh Gi√° TB</h3>
            <p style="font-size: 24px; font-weight: bold; color: #ffc107;">{{ dashboard_stats.RealAvgRating }} / 5.0</p>
        </div>
        <div style="border: 1px solid #ccc; padding: 15px; border-radius: 8px; flex: 1; background-color: #f9f9f9;">
            <h3>üèÜ S·∫£n Ph·∫©m B√°n Ch·∫°y</h3>
            <p style="font-size: 18px; font-weight: bold; color: #dc3545;">{{ best_seller }}</p>
        </div>
    </div>

    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
        <div style="border: 1px solid #ccc; padding: 15px; border-radius: 8px; flex: 1;">
            <p><strong>T·ªïng ƒê∆°n H√†ng:</strong> {{ dashboard_stats.TotalOrders }}</p>
            <p><strong>T·ªïng S·∫£n Ph·∫©m ƒê√£ B√°n:</strong> {{ dashboard_stats.TotalProductsSold }}</p>
            <p><strong>T·ªïng S·ªë Item ƒêang B√°n:</strong> {{ dashboard_stats.TotalItems }}</p>
        </div>
    </div>

    <hr>

    <h3>üìà Hi·ªáu Qu·∫£ Kinh Doanh S·∫£n Ph·∫©m</h3>
    <div style="max-height: 300px; overflow-y: auto; border: 1px solid #eee; margin-bottom: 30px;">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>T√™n S·∫£n Ph·∫©m</th>
                    <th>Gi√°</th>
                    <th>ƒê√£ B√°n</th>
                    <th>T·ªìn Kho</th>
                    <th>ƒê√°nh Gi√°</th>
                    <th>Tr·∫°ng Th√°i</th>
                </tr>
            </thead>
            <tbody>
                {% for p in product_performance %}
                <tr>
                    <td>{{ p.prod_id }}</td>
                    <td>{{ p.prod_name }}</td>
                    <td>{{ p.price | format_currency }}</td>
                    <td>{{ p.total_sales }}</td>
                    <td>{{ p.stock_quantity }}</td>
                    <td>{{ p.rating_avg }}</td>
                    <td>{{ p.status }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <hr>

    <h2>üì¶ Qu·∫£n L√Ω S·∫£n Ph·∫©m (Danh S√°ch ƒê·∫ßy ƒê·ªß)</h2>
    
    <div style="margin-bottom: 15px;">
        <a href="{{ url_for('add_product') }}" class="btn btn-success">‚ûï Th√™m S·∫£n Ph·∫©m M·ªõi</a>
    </div>
    
    <!-- Form T√¨m ki·∫øm & L·ªçc -->
    <form method="GET" action="{{ url_for('seller_dashboard') }}" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
        <div style="display: flex; gap: 10px;">
            <input type="text" name="keyword" placeholder="T√¨m t√™n s·∫£n ph·∫©m..." value="{{ current_keyword }}" style="padding: 8px; width: 300px;">
            
            <select name="status_filter" style="padding: 8px;">
                <option value="">-- T·∫•t c·∫£ tr·∫°ng th√°i --</option>
                <option value="C√≤n h√†ng" {% if current_status == 'C√≤n h√†ng' %}selected{% endif %}>C√≤n h√†ng (Stock > 0)</option>
                <option value="H·∫øt h√†ng" {% if current_status == 'H·∫øt h√†ng' %}selected{% endif %}>H·∫øt h√†ng</option>
                <option value="Ng·ª´ng kinh doanh" {% if current_status == 'Ng·ª´ng kinh doanh' %}selected{% endif %}>Ng·ª´ng kinh doanh</option>
            </select>
            
            <button type="submit" style="padding: 8px 15px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">L·ªçc</button>
            <a href="{{ url_for('seller_dashboard') }}" style="padding: 8px 15px; background: #6c757d; color: white; text-decoration: none; border-radius: 4px;">Reset</a>
        </div>
    </form>

    <table class="table table-bordered">
        <thead>
            <tr>
                {% for col in columns %}
                    <th>{{ col }}</th>
                {% endfor %}
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                {% for col in columns %}
                    <td>
                        {% if col == 'price' or col == 'sub_total' or col == 'total_payment' %}
                            {{ product[col] | format_currency }}
                        {% else %}
                            {{ product[col] }}
                        {% endif %}
                    </td>
                {% endfor %}
                <td>
                    <a href="{{ url_for('edit_product', prod_id=product['prod_id']) }}" class="btn btn-sm btn-warning">S·ª≠a</a>
                    <form action="{{ url_for('delete_product', prod_id=product['prod_id']) }}" method="POST" style="display:inline;" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a?');">
                        <button type="submit" class="btn btn-sm btn-danger">X√≥a</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="{{ columns|length + 1 }}" style="text-align: center;">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

{% endblock %}