{% extends "base.html" %}

{% block title %}Qu·∫£n L√Ω S·∫£n Ph·∫©m - K√™nh B√°n H√†ng{% endblock %}

{% block content %}
    <style>
        /* CSS cho h·ªá th·ªëng Tab */
        .tab-menu { list-style: none; padding: 0; margin: 0 0 20px 0; border-bottom: 2px solid #ddd; display: flex; }
        .tab-menu li { padding: 10px 20px; cursor: pointer; border: 1px solid transparent; border-bottom: none; margin-right: 5px; font-weight: 500; color: #777; }
        .tab-menu li.active { border-color: #ddd #ddd #fff; color: #ee4d2d; font-weight: bold; }
        .tab-content { border: 1px solid #ddd; padding: 20px; min-height: 400px; background-color: #fff; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }
        .data-table th, .data-table td { border: 1px solid #e0e0e0; padding: 10px; }
        .data-table th { background-color: #f0f0f0; }
    </style>

    {% if is_customer_user %}
        <div style="float: right; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: #e3f2fd;">
            B·∫°n l√† <strong>SHOP</strong>. <a href="{{ url_for('customer_dashboard') }}">Chuy·ªÉn sang Trang Mua H√†ng üõçÔ∏è</a>
        </div>
    {% endif %}

    <div style="margin-bottom: 20px; clear: both; padding-top: 10px;">
        <a href="{{ url_for('seller_products') }}" class="btn btn-primary" style="font-size: 18px;">üì¶ Qu·∫£n L√Ω Danh S√°ch S·∫£n Ph·∫©m</a>
        <a href="{{ url_for('seller_reports') }}" class="btn" style="font-size: 18px; margin-left: 10px; background-color: #28a745; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">üìä Xem B√°o C√°o</a>
    </div>

    <ul class="tab-menu">
        <li class="tab-item active" data-tab="overview">T·ªïng Quan Shop</li>
        <li class="tab-item" data-tab="customers">Danh S√°ch Kh√°ch H√†ng</li>
        <li class="tab-item" data-tab="sales-history">L·ªãch S·ª≠ B√°n H√†ng</li>
    </ul>

    <div class="tab-content">
        <!-- Tab 1: T·ªïng Quan -->
        <div id="overview" class="tab-pane active">
            <h2>üìä T·ªïng Quan Shop</h2>
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div style="border: 1px solid #ccc; padding: 15px; border-radius: 8px; flex: 1; background-color: #f9f9f9;">
                    <h3>üí∞ Doanh Thu T·ªïng</h3>
                    <p style="font-size: 24px; font-weight: bold; color: #28a745;">{{ dashboard_stats.TotalRevenue | format_currency }}</p>
                </div>
                <div style="border: 1px solid #ccc; padding: 15px; border-radius: 8px; flex: 1; background-color: #f9f9f9;">
                    <h3>‚≠ê ƒê√°nh Gi√° TB</h3>
                    <p style="font-size: 24px; font-weight: bold; color: #ffc107;">{{ dashboard_stats.RealAvgRating }} / 5.0</p>
                </div>
                <div style="border: 1px solid #ccc; padding: 15px; border-radius: 8px; flex: 1; background-color: #f9f9f9;">
                    <h3>üèÜ S·∫£n Ph·∫©m B√°n Ch·∫°y</h3>
                    <p style="font-size: 18px; font-weight: bold; color: #dc3545;">{{ best_seller }}</p>
                </div>
            </div>

            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div style="border: 1px solid #ccc; padding: 15px; border-radius: 8px; flex: 1;">
                    <p><strong>T·ªïng ƒê∆°n H√†ng:</strong> {{ dashboard_stats.TotalOrders }}</p>
                    <p><strong>T·ªïng S·∫£n Ph·∫©m ƒê√£ B√°n:</strong> {{ dashboard_stats.TotalProductsSold }}</p>
                    <p><strong>T·ªïng S·ªë Item ƒêang B√°n:</strong> {{ dashboard_stats.TotalItems }}</p>
                </div>
            </div>
        </div>

        <!-- Tab 2: Danh S√°ch Kh√°ch H√†ng -->
        <div id="customers" class="tab-pane">
            <h3>üë• Danh S√°ch Kh√°ch H√†ng ƒê√£ Mua</h3>
            {% if customer_list %}
            <table class="data-table" style="width: 100%;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>T√™n ƒêƒÉng Nh·∫≠p</th>
                        <th>SƒêT</th>
                        <th>S·ªë ƒê∆°n ƒê√£ Mua</th>
                        <th>T·ªïng Chi Ti√™u</th>
                    </tr>
                </thead>
                <tbody>
                {% for cust in customer_list %}
                    <tr>
                        <td>{{ cust.user_id }}</td>
                        <td>{{ cust.username }}</td>
                        <td>{{ cust.phone_number }}</td>
                        <td>{{ cust.TotalOrders }}</td>
                        <td>{{ cust.TotalSpent | format_currency }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            {% else %}
                <p>Ch∆∞a c√≥ kh√°ch h√†ng n√†o.</p>
            {% endif %}
        </div>

        <!-- Tab 3: L·ªãch S·ª≠ B√°n H√†ng -->
        <div id="sales-history" class="tab-pane">
            <h3>üìú L·ªãch S·ª≠ B√°n H√†ng Chi Ti·∫øt</h3>
            {% if sales_history %}
            <table class="data-table" style="width: 100%;">
                <thead>
                    <tr>
                        <th>M√£ ƒê∆°n</th>
                        <th>Ng√†y ƒê·∫∑t</th>
                        <th>Kh√°ch H√†ng</th>
                        <th>S·∫£n Ph·∫©m</th>
                        <th>SL</th>
                        <th>Th√†nh Ti·ªÅn</th>
                        <th>Tr·∫°ng Th√°i</th>
                    </tr>
                </thead>
                <tbody>
                {% for sale in sales_history %}
                    <tr>
                        <td>{{ sale.order_group_id }}</td>
                        <td>{{ sale.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>{{ sale.CustomerName }}</td>
                        <td>{{ sale.prod_name }}</td>
                        <td>{{ sale.quantity }}</td>
                        <td>{{ sale.sub_total | format_currency }}</td>
                        <td><strong>{{ sale.latest_status }}</strong></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            {% else %}
                <p>Ch∆∞a c√≥ l·ªãch s·ª≠ b√°n h√†ng.</p>
            {% endif %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.tab-item');
            const contents = document.querySelectorAll('.tab-pane');

            function activateTab(tabId) {
                tabs.forEach(t => {
                    if (t.getAttribute('data-tab') === tabId) {
                        t.classList.add('active');
                    } else {
                        t.classList.remove('active');
                    }
                });
                contents.forEach(c => {
                    if (c.id === tabId) {
                        c.classList.add('active');
                    } else {
                        c.classList.remove('active');
                    }
                });
            }

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-tab');
                    activateTab(targetId);
                });
            });
        });
    </script>
{% endblock %}